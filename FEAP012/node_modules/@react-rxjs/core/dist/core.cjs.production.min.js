"use strict";var j=Object.create;var O=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var r in t)O(e,r,{get:t[r],enumerable:!0})},N=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Z(t))!z.call(e,n)&&n!==r&&O(e,n,{get:()=>t[n],enumerable:!(s=W(t,n))||s.enumerable});return e};var G=(e,t,r)=>(r=e!=null?j(q(e)):{},N(t||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e)),H=e=>N(O({},"__esModule",{value:!0}),e);var K={};B(K,{RemoveSubscribe:()=>F,SUSPENSE:()=>i.SUSPENSE,Subscribe:()=>L,bind:()=>U,liftSuspense:()=>i.liftSuspense,shareLatest:()=>w,sinkSuspense:()=>i.sinkSuspense,state:()=>k,useStateObservable:()=>c,withDefault:()=>i.withDefault});module.exports=H(K);var i=require("@rx-state/core");var u={};var R=require("@rx-state/core");function v(e,t){let s=(0,R.state)(...t===u?[e]:[e,t]);return[(...n)=>c(s(...n)),s]}var E=require("@rx-state/core");function y(e,t){let r=t===u?(0,E.state)(e):(0,E.state)(e,t);return[()=>c(r),r]}function U(e,t){return(typeof e=="function"?v:y)(e,arguments.length>1?t:u)}var d=require("rxjs"),w=()=>(0,d.share)({connector:()=>new d.ReplaySubject(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0});var _=require("@rx-state/core"),Y=require("react");var p=require("@rx-state/core"),m=require("react");var x=require("use-sync-external-store/shim");var o=G(require("react")),C=require("rxjs"),g=require("@rx-state/core");var V=(0,o.createContext)(null),{Provider:D}=V,M=()=>(0,o.useContext)(V),I=Promise.resolve(),J=()=>{throw I},L=({source$:e,children:t,fallback:r})=>{let s=(0,o.useRef)();if(!s.current){let a=new C.Subscription;s.current={s:a,u:S=>{let f=u,h=!0;if(a.add((0,g.liftSuspense)()(S).subscribe({error:P=>{if(h){f=P;return}b(()=>{throw P})}})),h=!1,f!==u)throw f}}}let[n,b]=(0,o.useState)(null);if(n!==null&&n!==e)if(e===void 0)b(e);else try{e.getValue(),b(e)}catch(a){}(0,o.useEffect)(()=>{if(b(e),!e)return;let a=(0,g.liftSuspense)()(e).subscribe({error:S=>b(()=>{throw S})});return()=>{a.unsubscribe()}},[e]),(0,o.useEffect)(()=>()=>{var a;(a=s.current)==null||a.s.unsubscribe(),s.current=void 0},[]);let l=n===e?o.default.createElement(D,{value:s.current.u},t):r===void 0?null:o.default.createElement(J,null);return r===void 0?l:n===null?r:o.default.createElement(o.Suspense,{fallback:r},l)},F=({children:e})=>o.default.createElement(D,{value:null},e);var c=e=>{let t=M(),[,r]=(0,m.useState)(),s=(0,m.useRef)();if(!s.current){let b=a=>{let S=a.getValue();if(S instanceof p.StatePromise)throw S.catch(f=>{if(f instanceof p.NoSubscribersError)return f;throw f});return S},l=()=>{let a=s.current.source$;if(!a.getRefCount()&&!a.getDefaultValue){if(!t)throw new Error("Missing Subscribe!");t(a)}return b(a)};s.current={source$:null,args:[,l,l]}}let n=s.current;return n.source$!==e&&(n.source$=e,n.args[0]=b=>{let l=(0,p.liftSuspense)()(e).subscribe({next:b,error:a=>{r(()=>{throw a})}});return()=>{l.unsubscribe()}}),(0,x.useSyncExternalStore)(...n.args)};var k=(...e)=>{let t=(0,_.state)(...e);return typeof t=="function"?(...r)=>T(t(...r)):T(t)},A=new WeakMap;function T(e){A.has(e)||A.set(e,(0,Y.createElement)(()=>c(e),{}));let t=e.pipeState.bind(e);return Object.assign(e,A.get(e),{pipeState:(...r)=>T(t(...r))})}
//# sourceMappingURL=core.cjs.production.min.js.map
